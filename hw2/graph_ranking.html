<!DOCTYPE html>
<html>
<head>
<script src="http://d3js.org/d3.v3.min.js"></script>
  <style type="text/css">
    body {
      width: 800px;
      margin: 25px auto;
      font-family: "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif;
    }
    circle {
      stroke: #fff;
      stroke-width: 1;
    }
    .link {
      stroke: #999;
      stroke-opacity: .6;
    }
  </style>
</head>
<body>
  <pre>
	  Todo:
	  - circle strokes
	  - ask about sorting best practice
	  - ask if necessary to implement asc/desc
  </pre>
  <script type="text/javascript">

  // Original demo from Mike Bostock: http://bl.ocks.org/mbostock/4062045

  var margin = {top: 40, bottom: 10, left: 20, right: 20};
  var width = 800 - margin.left - margin.right;
  var height = 2430 - margin.top - margin.bottom;
  
  var nodeRadius = 5;

  // Creates sources <svg> element and inner g (for margins)
  var svg = d3.select("body").append("svg")
              .attr("width", width+margin.left+margin.right)
              .attr("height", height+margin.top+margin.bottom)
            .append("g")
              .attr("transform", "translate("+margin.left+","+margin.top+")");
			  
  var body = d3.select("body");

  /////////////////////////


  var force = d3.layout.force()
	  .charge(-200)
	  .size([width, height]);
	  
  var accesor_sort_field = function(d) {
	  return d[sort_field];
  }
	  
  var accessor_population = function(d) {
    return d.population;
  }
	  
  var accessor_gdp = function(d) {
    return d.gdp;
  }

  var accessor_life_expectancy = function(d) {
    return d.life_expectancy;
  }	  
	  
	    
  var layout = 0; //0 = even spaced, 1 = scaled
  var sort_field = "gdp";

  d3.json("data/countries_2012.json", function(data) {
	var yScale = d3.scale.linear()
		.domain(d3.extent(data, accesor_sort_field))
		.range([0,height]);  
	
	 
	body.append("span").text("Layout: ");
	
	body.append("input").attr("type", "radio")
		.attr("name", "Layout")
		.attr("value", 0)
		.attr("checked", true)
		.on("change", function () {
			layout = 0;
			updateLayout();
		})
	body.append("span").text("Even-Spaced");
	
	body.append("input").attr("type", "radio")
		.attr("name", "Layout")
		.attr("value", 0)
		.html("Scaled")
		.on("change", function () {
			layout = 1;
			updateLayout();
		})
		
	body.append("span").text("Scaled");
	
	body.append("br");
	
	d3.select("body").append("span").text("Sort by: ");
	
	var select = d3.select("body").append("select")
		.attr("id","selectSort")
		.on("change", function () {	
			sort_field = d3.select("select[id=selectSort]").node().value;
			yScale.domain(d3.extent(data, accesor_sort_field));
			updateLayout();
		});

	select.append("option").attr("value", "gdp").text("GDP")
	select.append("option").attr("value", "population").text("Population")
	select.append("option").attr("value", "life_expectancy").text("Life Expectancy");
		
	graph_update();
	
	function graph_update() {
			
	    // Nodes data join
	    var node = svg.selectAll(".node")
		.data(data);
			
	    node
	      .enter().append("circle");
	
	    node
	        .attr("class", "node")
	        .attr("r", nodeRadius)
			.attr("stroke","red")
			.attr("stroke-width","2")

	        
	    node
	      .exit()
	      .remove();
		  
		var text = svg.selectAll(".text")
		.data(data);
			
	    text
			.enter().append("text");
	
		text
			.attr("class", "text")
	        .text(function (d) {
				return d.name;
			})
	        
		text
	      .exit()
	      .remove();
		  
		  
		 updateLayout();
	}
	
	function updateLayout() {
	  if (layout==0) {
		  	svg.selectAll(".node")
			.sort(function (a,b) {
				return d3.ascending(a[sort_field], b[sort_field])
			})
			.transition()
			.attr("cy", function (d, i) {
				return i*4*nodeRadius;
			});

			svg.selectAll(".text")
			.sort(function (a,b) {
				return d3.ascending(a[sort_field], b[sort_field])
			})
			.transition()
			.attr("x", 2 * nodeRadius)
			.attr("y", function (d, i) {
				return i*4*nodeRadius + nodeRadius;
			});
			
			
		} else {
			svg.selectAll(".node")
			.transition()
			.attr("cy", function (d) {
				return yScale(accesor_sort_field(d));
			});

			svg.selectAll(".text")
			.transition()
			.attr("x", 2 * nodeRadius)
			.attr("y", function (d, i) {
				return yScale(accesor_sort_field(d)) + nodeRadius;
			})
		}
  	
	}
  });
  
  </script>
</body>
</html>